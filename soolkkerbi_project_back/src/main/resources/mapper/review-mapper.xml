<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="kr.or.skb.review.model.dao.ReviewDao">
  <insert id="insertReview">
  	insert into review values
  	(review_seq.nextval,#{reviewMemberNo},#{reviewProductNo},#{reviewTitle},#{reviewContent},#{reviewRate},0,sysdate)
  </insert>
  
  <select id="totalCount" resultType="int">
  	select count(*) from (select * from review join member on (review_member_no = member_no) where member_id=#{memberId})
  </select>
  
  <select id="selectMyReviewList" resultType="review">
  	 select * from
        (select rownum as rnum, r.* from
            (select 
                review_no,
                review_member_no,
                review_product_no,
                product_name,
                review_title,
                review_read_count,
                to_char(review_date,'yyyy.mm.dd')review_date
            from review 
            join member on (member_no = review_member_no)
            join product on (product_no = review_product_no) 
            where member_id=#{memberId} order by 1 desc)r)
    where rnum between #{start} and #{end}
  </select>
  
  <select id="totalCount2" resultType="int">
  	select count(*) from review where review_product_no=#{productNo}
  </select>
  
  <select id="selectProductReview" resultType="review">
  	select * from
    	(select rownum as rnum, r.* from
		    (select  
		        review_no,
		        review_member_no,
		        review_product_no,
		        review_title,
		        review_content,
		        review_rate,
		        review_read_count,
		        to_char(review_date,'yyyy-mm-dd')as review_date,
		        (substr(member_name,1,1)||lpad('*',length(member_name)-1,'*'))as member_name
		    from review 
		    join member on (member_no = review_member_no)
		    where review_product_no=49 order by 1 desc)r)
where rnum between 1 and 5
  </select>
</mapper>
